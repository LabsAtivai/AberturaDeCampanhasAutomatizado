version: "3.8"

services:
  backend-aberturas:
    build: 
      context: ./backend
      dockerfile: Dockerfile
      args:
        - NODE_ENV=production
    volumes:
      - /srv/credentials/credentials.json:/usr/src/app/credentials.json
      # Para desenvolvimento, descomente:
      # - ./backend/src:/usr/src/app/src
      # - ./backend/nest-cli.json:/usr/src/app/nest-cli.json
    container_name: backend-aberturas
    restart: unless-stopped
    ports:
      - "3001:3000"
    environment:
      - NODE_ENV=production
      - TZ=America/Sao_Paulo
    networks:
      - ativaai
    # Build com cache otimizado
    command: node dist/main

  frontend-aberturas:
    build: 
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend-aberturas
    restart: unless-stopped
    ports:
      - "4173:4173"
    networks:
      - ativaai

networks:
  ativaai:
    external: true
